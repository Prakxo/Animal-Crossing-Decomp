.include "macros.inc"

.section .text

.org 0x80047E40

.global ShortCommandProc
ShortCommandProc:
/* 80047E40 00044DA0  3C 80 80 1F */	lis r4, __GBA@ha
/* 80047E44 00044DA4  54 63 40 2E */	slwi r3, r3, 8
/* 80047E48 00044DA8  38 04 6D 80 */	addi r0, r4, __GBA@l
/* 80047E4C 00044DAC  7C 60 1A 14 */	add r3, r0, r3
/* 80047E50 00044DB0  80 03 00 20 */	lwz r0, 0x20(r3)
/* 80047E54 00044DB4  2C 00 00 00 */	cmpwi r0, 0
/* 80047E58 00044DB8  4C 82 00 20 */	bnelr 
/* 80047E5C 00044DBC  88 03 00 05 */	lbz r0, 5(r3)
/* 80047E60 00044DC0  28 00 00 00 */	cmplwi r0, 0
/* 80047E64 00044DC4  40 82 00 10 */	bne lbl_80047E74
/* 80047E68 00044DC8  88 03 00 06 */	lbz r0, 6(r3)
/* 80047E6C 00044DCC  28 00 00 04 */	cmplwi r0, 4
/* 80047E70 00044DD0  41 82 00 10 */	beq lbl_80047E80
lbl_80047E74:
/* 80047E74 00044DD4  38 00 00 01 */	li r0, 1
/* 80047E78 00044DD8  90 03 00 20 */	stw r0, 0x20(r3)
/* 80047E7C 00044DDC  4E 80 00 20 */	blr 
lbl_80047E80:
/* 80047E80 00044DE0  88 03 00 07 */	lbz r0, 7(r3)
/* 80047E84 00044DE4  80 63 00 14 */	lwz r3, 0x14(r3)
/* 80047E88 00044DE8  70 00 00 3A */	andi. r0, r0, 0x3a
/* 80047E8C 00044DEC  98 03 00 00 */	stb r0, 0(r3)
/* 80047E90 00044DF0  4E 80 00 20 */	blr 

.global GBAInit
GBAInit:
/* 80047E94 00044DF4  7C 08 02 A6 */	mflr r0
/* 80047E98 00044DF8  3C 60 80 00 */	lis r3, 0x800000F8@ha
/* 80047E9C 00044DFC  90 01 00 04 */	stw r0, 4(r1)
/* 80047EA0 00044E00  3C 80 80 1F */	lis r4, __GBA@ha
/* 80047EA4 00044E04  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 80047EA8 00044E08  BF 61 00 0C */	stmw r27, 0xc(r1)
/* 80047EAC 00044E0C  3B A4 6D 80 */	addi r29, r4, __GBA@l
/* 80047EB0 00044E10  3B 60 00 00 */	li r27, 0
/* 80047EB4 00044E14  3B E0 00 00 */	li r31, 0
/* 80047EB8 00044E18  80 03 00 F8 */	lwz r0, 0x800000F8@l(r3)
/* 80047EBC 00044E1C  3C 60 43 1C */	lis r3, 0x431BDE83@ha
/* 80047EC0 00044E20  38 63 DE 83 */	addi r3, r3, 0x431BDE83@l
/* 80047EC4 00044E24  54 00 F0 BE */	srwi r0, r0, 2
/* 80047EC8 00044E28  7C 03 00 16 */	mulhwu r0, r3, r0
/* 80047ECC 00044E2C  54 00 8B FE */	srwi r0, r0, 0xf
/* 80047ED0 00044E30  1C 00 00 3C */	mulli r0, r0, 0x3c
/* 80047ED4 00044E34  3C 60 80 1F */	lis r3, SecParams@ha
/* 80047ED8 00044E38  3B 83 6C 80 */	addi r28, r3, SecParams@l
/* 80047EDC 00044E3C  54 1E E8 FE */	srwi r30, r0, 3
lbl_80047EE0:
/* 80047EE0 00044E40  93 DD 00 34 */	stw r30, 0x34(r29)
/* 80047EE4 00044E44  38 7D 00 24 */	addi r3, r29, 0x24
/* 80047EE8 00044E48  93 FD 00 30 */	stw r31, 0x30(r29)
/* 80047EEC 00044E4C  48 03 5D E1 */	bl OSInitThreadQueue
/* 80047EF0 00044E50  3B 7B 00 01 */	addi r27, r27, 1
/* 80047EF4 00044E54  93 9D 00 F8 */	stw r28, 0xf8(r29)
/* 80047EF8 00044E58  2C 1B 00 04 */	cmpwi r27, 4
/* 80047EFC 00044E5C  3B BD 01 00 */	addi r29, r29, 0x100
/* 80047F00 00044E60  3B 9C 00 40 */	addi r28, r28, 0x40
/* 80047F04 00044E64  41 80 FF DC */	blt lbl_80047EE0
/* 80047F08 00044E68  48 03 11 6D */	bl OSInitAlarm
/* 80047F0C 00044E6C  4B FE 4C D5 */	bl DSPInit
/* 80047F10 00044E70  38 00 00 00 */	li r0, 0
/* 80047F14 00044E74  3C 60 80 0E */	lis r3, ResetFunctionInfo@ha
/* 80047F18 00044E78  90 0D 8A 30 */	stw r0, __GBAReset-_SDA_BASE_(r13)
/* 80047F1C 00044E7C  38 63 A9 C8 */	addi r3, r3, ResetFunctionInfo@l
/* 80047F20 00044E80  48 03 49 A1 */	bl OSRegisterResetFunction
/* 80047F24 00044E84  BB 61 00 0C */	lmw r27, 0xc(r1)
/* 80047F28 00044E88  80 01 00 24 */	lwz r0, 0x24(r1)
/* 80047F2C 00044E8C  38 21 00 20 */	addi r1, r1, 0x20
/* 80047F30 00044E90  7C 08 03 A6 */	mtlr r0
/* 80047F34 00044E94  4E 80 00 20 */	blr 

.global GBAGetStatusAsync
GBAGetStatusAsync:
/* 80047F38 00044E98  7C 08 02 A6 */	mflr r0
/* 80047F3C 00044E9C  3C C0 80 1F */	lis r6, __GBA@ha
/* 80047F40 00044EA0  90 01 00 04 */	stw r0, 4(r1)
/* 80047F44 00044EA4  54 67 40 2E */	slwi r7, r3, 8
/* 80047F48 00044EA8  38 06 6D 80 */	addi r0, r6, __GBA@l
/* 80047F4C 00044EAC  94 21 FF F8 */	stwu r1, -8(r1)
/* 80047F50 00044EB0  7C E0 3A 14 */	add r7, r0, r7
/* 80047F54 00044EB4  80 07 00 1C */	lwz r0, 0x1c(r7)
/* 80047F58 00044EB8  28 00 00 00 */	cmplwi r0, 0
/* 80047F5C 00044EBC  41 82 00 0C */	beq lbl_80047F68
/* 80047F60 00044EC0  38 60 00 02 */	li r3, 2
/* 80047F64 00044EC4  48 00 00 28 */	b lbl_80047F8C
lbl_80047F68:
/* 80047F68 00044EC8  38 00 00 00 */	li r0, 0
/* 80047F6C 00044ECC  98 07 00 00 */	stb r0, 0(r7)
/* 80047F70 00044ED0  3C C0 80 04 */	lis r6, ShortCommandProc@ha
/* 80047F74 00044ED4  38 C6 7E 40 */	addi r6, r6, ShortCommandProc@l
/* 80047F78 00044ED8  90 87 00 14 */	stw r4, 0x14(r7)
/* 80047F7C 00044EDC  38 80 00 01 */	li r4, 1
/* 80047F80 00044EE0  90 A7 00 1C */	stw r5, 0x1c(r7)
/* 80047F84 00044EE4  38 A0 00 03 */	li r5, 3
/* 80047F88 00044EE8  48 00 17 69 */	bl __GBATransfer
lbl_80047F8C:
/* 80047F8C 00044EEC  80 01 00 0C */	lwz r0, 0xc(r1)
/* 80047F90 00044EF0  38 21 00 08 */	addi r1, r1, 8
/* 80047F94 00044EF4  7C 08 03 A6 */	mtlr r0
/* 80047F98 00044EF8  4E 80 00 20 */	blr 

.global GBAGetStatus
GBAGetStatus:
/* 80047F9C 00044EFC  7C 08 02 A6 */	mflr r0
/* 80047FA0 00044F00  90 01 00 04 */	stw r0, 4(r1)
/* 80047FA4 00044F04  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 80047FA8 00044F08  93 E1 00 1C */	stw r31, 0x1c(r1)
/* 80047FAC 00044F0C  3B E3 00 00 */	addi r31, r3, 0
/* 80047FB0 00044F10  3C 60 80 1F */	lis r3, __GBA@ha
/* 80047FB4 00044F14  57 E5 40 2E */	slwi r5, r31, 8
/* 80047FB8 00044F18  38 03 6D 80 */	addi r0, r3, __GBA@l
/* 80047FBC 00044F1C  7C E0 2A 14 */	add r7, r0, r5
/* 80047FC0 00044F20  80 07 00 1C */	lwz r0, 0x1c(r7)
/* 80047FC4 00044F24  28 00 00 00 */	cmplwi r0, 0
/* 80047FC8 00044F28  41 82 00 0C */	beq lbl_80047FD4
/* 80047FCC 00044F2C  38 60 00 02 */	li r3, 2
/* 80047FD0 00044F30  48 00 00 34 */	b lbl_80048004
lbl_80047FD4:
/* 80047FD4 00044F34  38 00 00 00 */	li r0, 0
/* 80047FD8 00044F38  98 07 00 00 */	stb r0, 0(r7)
/* 80047FDC 00044F3C  3C A0 80 05 */	lis r5, __GBASyncCallback@ha
/* 80047FE0 00044F40  38 05 95 2C */	addi r0, r5, __GBASyncCallback@l
/* 80047FE4 00044F44  90 87 00 14 */	stw r4, 0x14(r7)
/* 80047FE8 00044F48  3C 60 80 04 */	lis r3, ShortCommandProc@ha
/* 80047FEC 00044F4C  38 C3 7E 40 */	addi r6, r3, ShortCommandProc@l
/* 80047FF0 00044F50  90 07 00 1C */	stw r0, 0x1c(r7)
/* 80047FF4 00044F54  38 7F 00 00 */	addi r3, r31, 0
/* 80047FF8 00044F58  38 80 00 01 */	li r4, 1
/* 80047FFC 00044F5C  38 A0 00 03 */	li r5, 3
/* 80048000 00044F60  48 00 16 F1 */	bl __GBATransfer
lbl_80048004:
/* 80048004 00044F64  2C 03 00 00 */	cmpwi r3, 0
/* 80048008 00044F68  41 82 00 08 */	beq lbl_80048010
/* 8004800C 00044F6C  48 00 00 0C */	b lbl_80048018
lbl_80048010:
/* 80048010 00044F70  7F E3 FB 78 */	mr r3, r31
/* 80048014 00044F74  48 00 15 4D */	bl __GBASync
lbl_80048018:
/* 80048018 00044F78  80 01 00 24 */	lwz r0, 0x24(r1)
/* 8004801C 00044F7C  83 E1 00 1C */	lwz r31, 0x1c(r1)
/* 80048020 00044F80  38 21 00 20 */	addi r1, r1, 0x20
/* 80048024 00044F84  7C 08 03 A6 */	mtlr r0
/* 80048028 00044F88  4E 80 00 20 */	blr 

.global GBAResetAsync
GBAResetAsync:
/* 8004802C 00044F8C  7C 08 02 A6 */	mflr r0
/* 80048030 00044F90  3C C0 80 1F */	lis r6, __GBA@ha
/* 80048034 00044F94  90 01 00 04 */	stw r0, 4(r1)
/* 80048038 00044F98  54 67 40 2E */	slwi r7, r3, 8
/* 8004803C 00044F9C  38 06 6D 80 */	addi r0, r6, __GBA@l
/* 80048040 00044FA0  94 21 FF F8 */	stwu r1, -8(r1)
/* 80048044 00044FA4  7C E0 3A 14 */	add r7, r0, r7
/* 80048048 00044FA8  80 07 00 1C */	lwz r0, 0x1c(r7)
/* 8004804C 00044FAC  28 00 00 00 */	cmplwi r0, 0
/* 80048050 00044FB0  41 82 00 0C */	beq lbl_8004805C
/* 80048054 00044FB4  38 60 00 02 */	li r3, 2
/* 80048058 00044FB8  48 00 00 28 */	b lbl_80048080
lbl_8004805C:
/* 8004805C 00044FBC  38 00 00 FF */	li r0, 0xff
/* 80048060 00044FC0  98 07 00 00 */	stb r0, 0(r7)
/* 80048064 00044FC4  3C C0 80 04 */	lis r6, ShortCommandProc@ha
/* 80048068 00044FC8  38 C6 7E 40 */	addi r6, r6, ShortCommandProc@l
/* 8004806C 00044FCC  90 87 00 14 */	stw r4, 0x14(r7)
/* 80048070 00044FD0  38 80 00 01 */	li r4, 1
/* 80048074 00044FD4  90 A7 00 1C */	stw r5, 0x1c(r7)
/* 80048078 00044FD8  38 A0 00 03 */	li r5, 3
/* 8004807C 00044FDC  48 00 16 75 */	bl __GBATransfer
lbl_80048080:
/* 80048080 00044FE0  80 01 00 0C */	lwz r0, 0xc(r1)
/* 80048084 00044FE4  38 21 00 08 */	addi r1, r1, 8
/* 80048088 00044FE8  7C 08 03 A6 */	mtlr r0
/* 8004808C 00044FEC  4E 80 00 20 */	blr 

.global GBAReset
GBAReset:
/* 80048090 00044FF0  7C 08 02 A6 */	mflr r0
/* 80048094 00044FF4  90 01 00 04 */	stw r0, 4(r1)
/* 80048098 00044FF8  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 8004809C 00044FFC  93 E1 00 1C */	stw r31, 0x1c(r1)
/* 800480A0 00045000  3B E3 00 00 */	addi r31, r3, 0
/* 800480A4 00045004  3C 60 80 1F */	lis r3, __GBA@ha
/* 800480A8 00045008  57 E5 40 2E */	slwi r5, r31, 8
/* 800480AC 0004500C  38 03 6D 80 */	addi r0, r3, __GBA@l
/* 800480B0 00045010  7C E0 2A 14 */	add r7, r0, r5
/* 800480B4 00045014  80 07 00 1C */	lwz r0, 0x1c(r7)
/* 800480B8 00045018  28 00 00 00 */	cmplwi r0, 0
/* 800480BC 0004501C  41 82 00 0C */	beq lbl_800480C8
/* 800480C0 00045020  38 60 00 02 */	li r3, 2
/* 800480C4 00045024  48 00 00 34 */	b lbl_800480F8
lbl_800480C8:
/* 800480C8 00045028  38 00 00 FF */	li r0, 0xff
/* 800480CC 0004502C  98 07 00 00 */	stb r0, 0(r7)
/* 800480D0 00045030  3C A0 80 05 */	lis r5, __GBASyncCallback@ha
/* 800480D4 00045034  38 05 95 2C */	addi r0, r5, __GBASyncCallback@l
/* 800480D8 00045038  90 87 00 14 */	stw r4, 0x14(r7)
/* 800480DC 0004503C  3C 60 80 04 */	lis r3, ShortCommandProc@ha
/* 800480E0 00045040  38 C3 7E 40 */	addi r6, r3, ShortCommandProc@l
/* 800480E4 00045044  90 07 00 1C */	stw r0, 0x1c(r7)
/* 800480E8 00045048  38 7F 00 00 */	addi r3, r31, 0
/* 800480EC 0004504C  38 80 00 01 */	li r4, 1
/* 800480F0 00045050  38 A0 00 03 */	li r5, 3
/* 800480F4 00045054  48 00 15 FD */	bl __GBATransfer
lbl_800480F8:
/* 800480F8 00045058  2C 03 00 00 */	cmpwi r3, 0
/* 800480FC 0004505C  41 82 00 08 */	beq lbl_80048104
/* 80048100 00045060  48 00 00 0C */	b lbl_8004810C
lbl_80048104:
/* 80048104 00045064  7F E3 FB 78 */	mr r3, r31
/* 80048108 00045068  48 00 14 59 */	bl __GBASync
lbl_8004810C:
/* 8004810C 0004506C  80 01 00 24 */	lwz r0, 0x24(r1)
/* 80048110 00045070  83 E1 00 1C */	lwz r31, 0x1c(r1)
/* 80048114 00045074  38 21 00 20 */	addi r1, r1, 0x20
/* 80048118 00045078  7C 08 03 A6 */	mtlr r0
/* 8004811C 0004507C  4E 80 00 20 */	blr 

.global OnReset
OnReset:
/* 80048120 00045080  38 00 00 01 */	li r0, 1
/* 80048124 00045084  90 0D 8A 30 */	stw r0, __GBAReset-_SDA_BASE_(r13)
/* 80048128 00045088  38 60 00 01 */	li r3, 1
/* 8004812C 0004508C  4E 80 00 20 */	blr 
