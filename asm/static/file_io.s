.include "macros.inc"

.section .text

.org 0x8009C9EC

.global fflush
fflush:
/* 8009C9EC 0009994C  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 8009C9F0 00099950  7C 08 02 A6 */	mflr r0
/* 8009C9F4 00099954  90 01 00 14 */	stw r0, 0x14(r1)
/* 8009C9F8 00099958  93 E1 00 0C */	stw r31, 0xc(r1)
/* 8009C9FC 0009995C  7C 7F 1B 79 */	or. r31, r3, r3
/* 8009CA00 00099960  93 C1 00 08 */	stw r30, 8(r1)
/* 8009CA04 00099964  40 82 00 0C */	bne lbl_8009CA10
/* 8009CA08 00099968  4B FF EC C9 */	bl __flush_all
/* 8009CA0C 0009996C  48 00 01 00 */	b lbl_8009CB0C
lbl_8009CA10:
/* 8009CA10 00099970  88 1F 00 0A */	lbz r0, 0xa(r31)
/* 8009CA14 00099974  28 00 00 00 */	cmplwi r0, 0
/* 8009CA18 00099978  40 82 00 10 */	bne lbl_8009CA28
/* 8009CA1C 0009997C  A0 1F 00 04 */	lhz r0, 4(r31)
/* 8009CA20 00099980  54 00 D7 7F */	rlwinm. r0, r0, 0x1a, 0x1d, 0x1f
/* 8009CA24 00099984  40 82 00 0C */	bne lbl_8009CA30
lbl_8009CA28:
/* 8009CA28 00099988  38 60 FF FF */	li r3, -1
/* 8009CA2C 0009998C  48 00 00 E0 */	b lbl_8009CB0C
lbl_8009CA30:
/* 8009CA30 00099990  88 1F 00 04 */	lbz r0, 4(r31)
/* 8009CA34 00099994  54 00 EF 7E */	rlwinm r0, r0, 0x1d, 0x1d, 0x1f
/* 8009CA38 00099998  28 00 00 01 */	cmplwi r0, 1
/* 8009CA3C 0009999C  40 82 00 0C */	bne lbl_8009CA48
/* 8009CA40 000999A0  38 60 00 00 */	li r3, 0
/* 8009CA44 000999A4  48 00 00 C8 */	b lbl_8009CB0C
lbl_8009CA48:
/* 8009CA48 000999A8  88 7F 00 08 */	lbz r3, 8(r31)
/* 8009CA4C 000999AC  54 60 DF 7E */	rlwinm r0, r3, 0x1b, 0x1d, 0x1f
/* 8009CA50 000999B0  28 00 00 03 */	cmplwi r0, 3
/* 8009CA54 000999B4  41 80 00 10 */	blt lbl_8009CA64
/* 8009CA58 000999B8  38 00 00 02 */	li r0, 2
/* 8009CA5C 000999BC  50 03 2E 34 */	rlwimi r3, r0, 5, 0x18, 0x1a
/* 8009CA60 000999C0  98 7F 00 08 */	stb r3, 8(r31)
lbl_8009CA64:
/* 8009CA64 000999C4  88 1F 00 08 */	lbz r0, 8(r31)
/* 8009CA68 000999C8  54 00 DF 7E */	rlwinm r0, r0, 0x1b, 0x1d, 0x1f
/* 8009CA6C 000999CC  28 00 00 02 */	cmplwi r0, 2
/* 8009CA70 000999D0  40 82 00 0C */	bne lbl_8009CA7C
/* 8009CA74 000999D4  38 00 00 00 */	li r0, 0
/* 8009CA78 000999D8  90 1F 00 28 */	stw r0, 0x28(r31)
lbl_8009CA7C:
/* 8009CA7C 000999DC  88 9F 00 08 */	lbz r4, 8(r31)
/* 8009CA80 000999E0  54 80 DF 7E */	rlwinm r0, r4, 0x1b, 0x1d, 0x1f
/* 8009CA84 000999E4  28 00 00 01 */	cmplwi r0, 1
/* 8009CA88 000999E8  41 82 00 18 */	beq lbl_8009CAA0
/* 8009CA8C 000999EC  38 00 00 00 */	li r0, 0
/* 8009CA90 000999F0  38 60 00 00 */	li r3, 0
/* 8009CA94 000999F4  50 04 2E 34 */	rlwimi r4, r0, 5, 0x18, 0x1a
/* 8009CA98 000999F8  98 9F 00 08 */	stb r4, 8(r31)
/* 8009CA9C 000999FC  48 00 00 70 */	b lbl_8009CB0C
lbl_8009CAA0:
/* 8009CAA0 00099A00  A0 1F 00 04 */	lhz r0, 4(r31)
/* 8009CAA4 00099A04  54 00 D7 7E */	rlwinm r0, r0, 0x1a, 0x1d, 0x1f
/* 8009CAA8 00099A08  28 00 00 01 */	cmplwi r0, 1
/* 8009CAAC 00099A0C  41 82 00 0C */	beq lbl_8009CAB8
/* 8009CAB0 00099A10  3B C0 00 00 */	li r30, 0
/* 8009CAB4 00099A14  48 00 00 10 */	b lbl_8009CAC4
lbl_8009CAB8:
/* 8009CAB8 00099A18  7F E3 FB 78 */	mr r3, r31
/* 8009CABC 00099A1C  48 00 03 85 */	bl ftell
/* 8009CAC0 00099A20  7C 7E 1B 78 */	mr r30, r3
lbl_8009CAC4:
/* 8009CAC4 00099A24  7F E3 FB 78 */	mr r3, r31
/* 8009CAC8 00099A28  38 80 00 00 */	li r4, 0
/* 8009CACC 00099A2C  4B FF FA D9 */	bl __flush_buffer
/* 8009CAD0 00099A30  2C 03 00 00 */	cmpwi r3, 0
/* 8009CAD4 00099A34  41 82 00 1C */	beq lbl_8009CAF0
/* 8009CAD8 00099A38  38 60 00 01 */	li r3, 1
/* 8009CADC 00099A3C  38 00 00 00 */	li r0, 0
/* 8009CAE0 00099A40  98 7F 00 0A */	stb r3, 0xa(r31)
/* 8009CAE4 00099A44  38 60 FF FF */	li r3, -1
/* 8009CAE8 00099A48  90 1F 00 28 */	stw r0, 0x28(r31)
/* 8009CAEC 00099A4C  48 00 00 20 */	b lbl_8009CB0C
lbl_8009CAF0:
/* 8009CAF0 00099A50  88 1F 00 08 */	lbz r0, 8(r31)
/* 8009CAF4 00099A54  38 80 00 00 */	li r4, 0
/* 8009CAF8 00099A58  50 80 2E 34 */	rlwimi r0, r4, 5, 0x18, 0x1a
/* 8009CAFC 00099A5C  38 60 00 00 */	li r3, 0
/* 8009CB00 00099A60  98 1F 00 08 */	stb r0, 8(r31)
/* 8009CB04 00099A64  93 DF 00 18 */	stw r30, 0x18(r31)
/* 8009CB08 00099A68  90 9F 00 28 */	stw r4, 0x28(r31)
lbl_8009CB0C:
/* 8009CB0C 00099A6C  80 01 00 14 */	lwz r0, 0x14(r1)
/* 8009CB10 00099A70  83 E1 00 0C */	lwz r31, 0xc(r1)
/* 8009CB14 00099A74  83 C1 00 08 */	lwz r30, 8(r1)
/* 8009CB18 00099A78  7C 08 03 A6 */	mtlr r0
/* 8009CB1C 00099A7C  38 21 00 10 */	addi r1, r1, 0x10
/* 8009CB20 00099A80  4E 80 00 20 */	blr 

.global fclose
fclose:
/* 8009CB24 00099A84  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 8009CB28 00099A88  7C 08 02 A6 */	mflr r0
/* 8009CB2C 00099A8C  90 01 00 24 */	stw r0, 0x24(r1)
/* 8009CB30 00099A90  93 E1 00 1C */	stw r31, 0x1c(r1)
/* 8009CB34 00099A94  93 C1 00 18 */	stw r30, 0x18(r1)
/* 8009CB38 00099A98  93 A1 00 14 */	stw r29, 0x14(r1)
/* 8009CB3C 00099A9C  7C 7D 1B 79 */	or. r29, r3, r3
/* 8009CB40 00099AA0  40 82 00 0C */	bne lbl_8009CB4C
/* 8009CB44 00099AA4  38 60 FF FF */	li r3, -1
/* 8009CB48 00099AA8  48 00 00 80 */	b lbl_8009CBC8
lbl_8009CB4C:
/* 8009CB4C 00099AAC  A0 1D 00 04 */	lhz r0, 4(r29)
/* 8009CB50 00099AB0  54 00 D7 7F */	rlwinm. r0, r0, 0x1a, 0x1d, 0x1f
/* 8009CB54 00099AB4  40 82 00 0C */	bne lbl_8009CB60
/* 8009CB58 00099AB8  38 60 00 00 */	li r3, 0
/* 8009CB5C 00099ABC  48 00 00 6C */	b lbl_8009CBC8
lbl_8009CB60:
/* 8009CB60 00099AC0  4B FF FE 8D */	bl fflush
/* 8009CB64 00099AC4  81 9D 00 44 */	lwz r12, 0x44(r29)
/* 8009CB68 00099AC8  7C 7E 1B 78 */	mr r30, r3
/* 8009CB6C 00099ACC  80 7D 00 00 */	lwz r3, 0(r29)
/* 8009CB70 00099AD0  7D 89 03 A6 */	mtctr r12
/* 8009CB74 00099AD4  4E 80 04 21 */	bctrl 
/* 8009CB78 00099AD8  A0 1D 00 04 */	lhz r0, 4(r29)
/* 8009CB7C 00099ADC  38 80 00 00 */	li r4, 0
/* 8009CB80 00099AE0  50 80 35 F2 */	rlwimi r0, r4, 6, 0x17, 0x19
/* 8009CB84 00099AE4  7C 7F 1B 78 */	mr r31, r3
/* 8009CB88 00099AE8  B0 1D 00 04 */	sth r0, 4(r29)
/* 8009CB8C 00099AEC  90 9D 00 00 */	stw r4, 0(r29)
/* 8009CB90 00099AF0  88 1D 00 08 */	lbz r0, 8(r29)
/* 8009CB94 00099AF4  54 00 E7 FF */	rlwinm. r0, r0, 0x1c, 0x1f, 0x1f
/* 8009CB98 00099AF8  41 82 00 0C */	beq lbl_8009CBA4
/* 8009CB9C 00099AFC  80 7D 00 1C */	lwz r3, 0x1c(r29)
/* 8009CBA0 00099B00  4B FC 03 95 */	bl free
lbl_8009CBA4:
/* 8009CBA4 00099B04  2C 1E 00 00 */	cmpwi r30, 0
/* 8009CBA8 00099B08  38 60 00 00 */	li r3, 0
/* 8009CBAC 00099B0C  40 82 00 0C */	bne lbl_8009CBB8
/* 8009CBB0 00099B10  2C 1F 00 00 */	cmpwi r31, 0
/* 8009CBB4 00099B14  41 82 00 08 */	beq lbl_8009CBBC
lbl_8009CBB8:
/* 8009CBB8 00099B18  38 60 00 01 */	li r3, 1
lbl_8009CBBC:
/* 8009CBBC 00099B1C  7C 03 00 D0 */	neg r0, r3
/* 8009CBC0 00099B20  7C 00 1B 78 */	or r0, r0, r3
/* 8009CBC4 00099B24  7C 03 FE 70 */	srawi r3, r0, 0x1f
lbl_8009CBC8:
/* 8009CBC8 00099B28  80 01 00 24 */	lwz r0, 0x24(r1)
/* 8009CBCC 00099B2C  83 E1 00 1C */	lwz r31, 0x1c(r1)
/* 8009CBD0 00099B30  83 C1 00 18 */	lwz r30, 0x18(r1)
/* 8009CBD4 00099B34  83 A1 00 14 */	lwz r29, 0x14(r1)
/* 8009CBD8 00099B38  7C 08 03 A6 */	mtlr r0
/* 8009CBDC 00099B3C  38 21 00 20 */	addi r1, r1, 0x20
/* 8009CBE0 00099B40  4E 80 00 20 */	blr 
