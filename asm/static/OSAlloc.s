.include "macros.inc"

.section .text

.org 0x80079720

.global OSAllocFromHeap
OSAllocFromHeap:
/* 80079720 00076680  1C 03 00 0C */	mulli r0, r3, 0xc
/* 80079724 00076684  80 6D 8D 68 */	lwz r3, HeapArray-_SDA_BASE_(r13)
/* 80079728 00076688  7C A3 02 14 */	add r5, r3, r0
/* 8007972C 0007668C  38 04 00 3F */	addi r0, r4, 0x3f
/* 80079730 00076690  80 C5 00 04 */	lwz r6, 4(r5)
/* 80079734 00076694  54 03 00 34 */	rlwinm r3, r0, 0, 0, 0x1a
/* 80079738 00076698  48 00 00 14 */	b lbl_8007974C
lbl_8007973C:
/* 8007973C 0007669C  80 06 00 08 */	lwz r0, 8(r6)
/* 80079740 000766A0  7C 03 00 00 */	cmpw r3, r0
/* 80079744 000766A4  40 81 00 10 */	ble lbl_80079754
/* 80079748 000766A8  80 C6 00 04 */	lwz r6, 4(r6)
lbl_8007974C:
/* 8007974C 000766AC  28 06 00 00 */	cmplwi r6, 0
/* 80079750 000766B0  40 82 FF EC */	bne lbl_8007973C
lbl_80079754:
/* 80079754 000766B4  28 06 00 00 */	cmplwi r6, 0
/* 80079758 000766B8  40 82 00 0C */	bne lbl_80079764
/* 8007975C 000766BC  38 60 00 00 */	li r3, 0
/* 80079760 000766C0  4E 80 00 20 */	blr 
lbl_80079764:
/* 80079764 000766C4  80 06 00 08 */	lwz r0, 8(r6)
/* 80079768 000766C8  7C 03 00 50 */	subf r0, r3, r0
/* 8007976C 000766CC  28 00 00 40 */	cmplwi r0, 0x40
/* 80079770 000766D0  40 80 00 40 */	bge lbl_800797B0
/* 80079774 000766D4  80 86 00 04 */	lwz r4, 4(r6)
/* 80079778 000766D8  80 65 00 04 */	lwz r3, 4(r5)
/* 8007977C 000766DC  28 04 00 00 */	cmplwi r4, 0
/* 80079780 000766E0  41 82 00 0C */	beq lbl_8007978C
/* 80079784 000766E4  80 06 00 00 */	lwz r0, 0(r6)
/* 80079788 000766E8  90 04 00 00 */	stw r0, 0(r4)
lbl_8007978C:
/* 8007978C 000766EC  80 86 00 00 */	lwz r4, 0(r6)
/* 80079790 000766F0  28 04 00 00 */	cmplwi r4, 0
/* 80079794 000766F4  40 82 00 0C */	bne lbl_800797A0
/* 80079798 000766F8  80 66 00 04 */	lwz r3, 4(r6)
/* 8007979C 000766FC  48 00 00 0C */	b lbl_800797A8
lbl_800797A0:
/* 800797A0 00076700  80 06 00 04 */	lwz r0, 4(r6)
/* 800797A4 00076704  90 04 00 04 */	stw r0, 4(r4)
lbl_800797A8:
/* 800797A8 00076708  90 65 00 04 */	stw r3, 4(r5)
/* 800797AC 0007670C  48 00 00 48 */	b lbl_800797F4
lbl_800797B0:
/* 800797B0 00076710  90 66 00 08 */	stw r3, 8(r6)
/* 800797B4 00076714  7C 86 1A 14 */	add r4, r6, r3
/* 800797B8 00076718  90 04 00 08 */	stw r0, 8(r4)
/* 800797BC 0007671C  80 06 00 00 */	lwz r0, 0(r6)
/* 800797C0 00076720  90 04 00 00 */	stw r0, 0(r4)
/* 800797C4 00076724  80 06 00 04 */	lwz r0, 4(r6)
/* 800797C8 00076728  90 04 00 04 */	stw r0, 4(r4)
/* 800797CC 0007672C  80 64 00 04 */	lwz r3, 4(r4)
/* 800797D0 00076730  28 03 00 00 */	cmplwi r3, 0
/* 800797D4 00076734  41 82 00 08 */	beq lbl_800797DC
/* 800797D8 00076738  90 83 00 00 */	stw r4, 0(r3)
lbl_800797DC:
/* 800797DC 0007673C  80 64 00 00 */	lwz r3, 0(r4)
/* 800797E0 00076740  28 03 00 00 */	cmplwi r3, 0
/* 800797E4 00076744  41 82 00 0C */	beq lbl_800797F0
/* 800797E8 00076748  90 83 00 04 */	stw r4, 4(r3)
/* 800797EC 0007674C  48 00 00 08 */	b lbl_800797F4
lbl_800797F0:
/* 800797F0 00076750  90 85 00 04 */	stw r4, 4(r5)
lbl_800797F4:
/* 800797F4 00076754  80 65 00 08 */	lwz r3, 8(r5)
/* 800797F8 00076758  38 00 00 00 */	li r0, 0
/* 800797FC 0007675C  90 66 00 04 */	stw r3, 4(r6)
/* 80079800 00076760  28 03 00 00 */	cmplwi r3, 0
/* 80079804 00076764  90 06 00 00 */	stw r0, 0(r6)
/* 80079808 00076768  41 82 00 08 */	beq lbl_80079810
/* 8007980C 0007676C  90 C3 00 00 */	stw r6, 0(r3)
lbl_80079810:
/* 80079810 00076770  90 C5 00 08 */	stw r6, 8(r5)
/* 80079814 00076774  38 66 00 20 */	addi r3, r6, 0x20
/* 80079818 00076778  4E 80 00 20 */	blr 

.global OSInitAlloc
OSInitAlloc:
/* 8007981C 0007677C  1C E5 00 0C */	mulli r7, r5, 0xc
/* 80079820 00076780  90 6D 8D 68 */	stw r3, HeapArray-_SDA_BASE_(r13)
/* 80079824 00076784  90 AD 8D 6C */	stw r5, NumHeaps-_SDA_BASE_(r13)
/* 80079828 00076788  38 C0 00 00 */	li r6, 0
/* 8007982C 0007678C  38 66 00 00 */	addi r3, r6, 0
/* 80079830 00076790  39 00 00 00 */	li r8, 0
/* 80079834 00076794  38 A0 FF FF */	li r5, -1
/* 80079838 00076798  48 00 00 20 */	b lbl_80079858
lbl_8007983C:
/* 8007983C 0007679C  80 0D 8D 68 */	lwz r0, HeapArray-_SDA_BASE_(r13)
/* 80079840 000767A0  39 08 00 01 */	addi r8, r8, 1
/* 80079844 000767A4  7D 20 32 14 */	add r9, r0, r6
/* 80079848 000767A8  90 A9 00 00 */	stw r5, 0(r9)
/* 8007984C 000767AC  38 C6 00 0C */	addi r6, r6, 0xc
/* 80079850 000767B0  90 69 00 08 */	stw r3, 8(r9)
/* 80079854 000767B4  90 69 00 04 */	stw r3, 4(r9)
lbl_80079858:
/* 80079858 000767B8  80 0D 8D 6C */	lwz r0, NumHeaps-_SDA_BASE_(r13)
/* 8007985C 000767BC  7C 08 00 00 */	cmpw r8, r0
/* 80079860 000767C0  41 80 FF DC */	blt lbl_8007983C
/* 80079864 000767C4  80 6D 8D 68 */	lwz r3, HeapArray-_SDA_BASE_(r13)
/* 80079868 000767C8  54 80 00 34 */	rlwinm r0, r4, 0, 0, 0x1a
/* 8007986C 000767CC  38 80 FF FF */	li r4, -1
/* 80079870 000767D0  90 0D 8D 74 */	stw r0, ArenaEnd-_SDA_BASE_(r13)
/* 80079874 000767D4  7C 63 3A 14 */	add r3, r3, r7
/* 80079878 000767D8  38 03 00 1F */	addi r0, r3, 0x1f
/* 8007987C 000767DC  90 8D 85 F0 */	stw r4, __OSCurrHeap-_SDA_BASE_(r13)
/* 80079880 000767E0  54 03 00 34 */	rlwinm r3, r0, 0, 0, 0x1a
/* 80079884 000767E4  90 6D 8D 70 */	stw r3, ArenaStart-_SDA_BASE_(r13)
/* 80079888 000767E8  4E 80 00 20 */	blr 
