.include "macros.inc"

.section .text

.org 0x8007C8C0

.global OSRegisterResetFunction
OSRegisterResetFunction:
/* 8007C8C0 00079820  80 AD 8D A8 */	lwz r5, ResetFunctionQueue-_SDA_BASE_(r13)
/* 8007C8C4 00079824  48 00 00 08 */	b lbl_8007C8CC
lbl_8007C8C8:
/* 8007C8C8 00079828  80 A5 00 08 */	lwz r5, 8(r5)
lbl_8007C8CC:
/* 8007C8CC 0007982C  28 05 00 00 */	cmplwi r5, 0
/* 8007C8D0 00079830  41 82 00 14 */	beq lbl_8007C8E4
/* 8007C8D4 00079834  80 85 00 04 */	lwz r4, 4(r5)
/* 8007C8D8 00079838  80 03 00 04 */	lwz r0, 4(r3)
/* 8007C8DC 0007983C  7C 04 00 40 */	cmplw r4, r0
/* 8007C8E0 00079840  40 81 FF E8 */	ble lbl_8007C8C8
lbl_8007C8E4:
/* 8007C8E4 00079844  28 05 00 00 */	cmplwi r5, 0
/* 8007C8E8 00079848  40 82 00 34 */	bne lbl_8007C91C
/* 8007C8EC 0007984C  38 AD 8D A8 */	addi r5, r13, ResetFunctionQueue-_SDA_BASE_
/* 8007C8F0 00079850  84 85 00 04 */	lwzu r4, 4(r5)
/* 8007C8F4 00079854  28 04 00 00 */	cmplwi r4, 0
/* 8007C8F8 00079858  40 82 00 0C */	bne lbl_8007C904
/* 8007C8FC 0007985C  90 6D 8D A8 */	stw r3, ResetFunctionQueue-_SDA_BASE_(r13)
/* 8007C900 00079860  48 00 00 08 */	b lbl_8007C908
lbl_8007C904:
/* 8007C904 00079864  90 64 00 08 */	stw r3, 8(r4)
lbl_8007C908:
/* 8007C908 00079868  90 83 00 0C */	stw r4, 0xc(r3)
/* 8007C90C 0007986C  38 00 00 00 */	li r0, 0
/* 8007C910 00079870  90 03 00 08 */	stw r0, 8(r3)
/* 8007C914 00079874  90 65 00 00 */	stw r3, 0(r5)
/* 8007C918 00079878  4E 80 00 20 */	blr 
lbl_8007C91C:
/* 8007C91C 0007987C  90 A3 00 08 */	stw r5, 8(r3)
/* 8007C920 00079880  80 85 00 0C */	lwz r4, 0xc(r5)
/* 8007C924 00079884  90 65 00 0C */	stw r3, 0xc(r5)
/* 8007C928 00079888  28 04 00 00 */	cmplwi r4, 0
/* 8007C92C 0007988C  90 83 00 0C */	stw r4, 0xc(r3)
/* 8007C930 00079890  40 82 00 0C */	bne lbl_8007C93C
/* 8007C934 00079894  90 6D 8D A8 */	stw r3, ResetFunctionQueue-_SDA_BASE_(r13)
/* 8007C938 00079898  4E 80 00 20 */	blr 
lbl_8007C93C:
/* 8007C93C 0007989C  90 64 00 08 */	stw r3, 8(r4)
/* 8007C940 000798A0  4E 80 00 20 */	blr 

.global Reset
Reset:
/* 8007C944 000798A4  48 00 00 20 */	b lbl_8007C964
lbl_8007C948:
/* 8007C948 000798A8  7D 10 FA A6 */	mfspr r8, 0x3f0
/* 8007C94C 000798AC  61 08 00 08 */	ori r8, r8, 8
/* 8007C950 000798B0  7D 10 FB A6 */	mtspr 0x3f0, r8
/* 8007C954 000798B4  4C 00 01 2C */	isync 
/* 8007C958 000798B8  7C 00 04 AC */	sync 0
/* 8007C95C 000798BC  60 00 00 00 */	nop 
/* 8007C960 000798C0  48 00 00 08 */	b lbl_8007C968
lbl_8007C964:
/* 8007C964 000798C4  48 00 00 20 */	b lbl_8007C984
lbl_8007C968:
/* 8007C968 000798C8  7C AC 42 E6 */	mftb r5, 0x10c
lbl_8007C96C:
/* 8007C96C 000798CC  7C CC 42 E6 */	mftb r6, 0x10c
/* 8007C970 000798D0  7C E5 30 50 */	subf r7, r5, r6
/* 8007C974 000798D4  28 07 11 24 */	cmplwi r7, 0x1124
/* 8007C978 000798D8  41 80 FF F4 */	blt lbl_8007C96C
/* 8007C97C 000798DC  60 00 00 00 */	nop 
/* 8007C980 000798E0  48 00 00 08 */	b lbl_8007C988
lbl_8007C984:
/* 8007C984 000798E4  48 00 00 20 */	b lbl_8007C9A4
lbl_8007C988:
/* 8007C988 000798E8  3D 00 CC 00 */	lis r8, 0xCC003000@h
/* 8007C98C 000798EC  61 08 30 00 */	ori r8, r8, 0xCC003000@l
/* 8007C990 000798F0  38 80 00 03 */	li r4, 3
/* 8007C994 000798F4  90 88 00 24 */	stw r4, 0x24(r8)
/* 8007C998 000798F8  90 68 00 24 */	stw r3, 0x24(r8)
/* 8007C99C 000798FC  60 00 00 00 */	nop 
/* 8007C9A0 00079900  48 00 00 08 */	b lbl_8007C9A8
lbl_8007C9A4:
/* 8007C9A4 00079904  48 00 00 0C */	b lbl_8007C9B0
lbl_8007C9A8:
/* 8007C9A8 00079908  60 00 00 00 */	nop 
/* 8007C9AC 0007990C  4B FF FF FC */	b lbl_8007C9A8
lbl_8007C9B0:
/* 8007C9B0 00079910  4B FF FF 98 */	b lbl_8007C948

.global __OSDoHotReset
__OSDoHotReset:
/* 8007C9B4 00079914  7C 08 02 A6 */	mflr r0
/* 8007C9B8 00079918  90 01 00 04 */	stw r0, 4(r1)
/* 8007C9BC 0007991C  94 21 FF E8 */	stwu r1, -0x18(r1)
/* 8007C9C0 00079920  93 E1 00 14 */	stw r31, 0x14(r1)
/* 8007C9C4 00079924  7C 7F 1B 78 */	mr r31, r3
/* 8007C9C8 00079928  4B FF E2 5D */	bl OSDisableInterrupts
/* 8007C9CC 0007992C  3C 60 CC 00 */	lis r3, 0xCC002000@ha
/* 8007C9D0 00079930  38 63 20 00 */	addi r3, r3, 0xCC002000@l
/* 8007C9D4 00079934  38 00 00 00 */	li r0, 0
/* 8007C9D8 00079938  B0 03 00 02 */	sth r0, 2(r3)
/* 8007C9DC 0007993C  4B FF D3 09 */	bl ICFlashInvalidate
/* 8007C9E0 00079940  57 E3 18 38 */	slwi r3, r31, 3
/* 8007C9E4 00079944  4B FF FF 61 */	bl Reset
/* 8007C9E8 00079948  80 01 00 1C */	lwz r0, 0x1c(r1)
/* 8007C9EC 0007994C  83 E1 00 14 */	lwz r31, 0x14(r1)
/* 8007C9F0 00079950  38 21 00 18 */	addi r1, r1, 0x18
/* 8007C9F4 00079954  7C 08 03 A6 */	mtlr r0
/* 8007C9F8 00079958  4E 80 00 20 */	blr 

.global OSResetSystem
OSResetSystem:
/* 8007C9FC 0007995C  7C 08 02 A6 */	mflr r0
/* 8007CA00 00079960  90 01 00 04 */	stw r0, 4(r1)
/* 8007CA04 00079964  94 21 FF C0 */	stwu r1, -0x40(r1)
/* 8007CA08 00079968  BF 41 00 28 */	stmw r26, 0x28(r1)
/* 8007CA0C 0007996C  7C 7A 1B 78 */	mr r26, r3
/* 8007CA10 00079970  7C 9D 23 78 */	mr r29, r4
/* 8007CA14 00079974  7C BE 2B 78 */	mr r30, r5
/* 8007CA18 00079978  48 00 13 05 */	bl OSDisableScheduler
/* 8007CA1C 0007997C  4B FF D0 4D */	bl __OSStopAudioSystem
/* 8007CA20 00079980  2C 1A 00 02 */	cmpwi r26, 2
/* 8007CA24 00079984  40 82 00 10 */	bne lbl_8007CA34
/* 8007CA28 00079988  38 60 00 01 */	li r3, 1
/* 8007CA2C 0007998C  48 00 EE 81 */	bl __PADDisableRecalibration
/* 8007CA30 00079990  7C 7F 1B 78 */	mr r31, r3
lbl_8007CA34:
/* 8007CA34 00079994  48 00 00 04 */	b lbl_8007CA38
lbl_8007CA38:
/* 8007CA38 00079998  48 00 00 04 */	b lbl_8007CA3C
lbl_8007CA3C:
/* 8007CA3C 0007999C  83 6D 8D A8 */	lwz r27, ResetFunctionQueue-_SDA_BASE_(r13)
/* 8007CA40 000799A0  3B 80 00 00 */	li r28, 0
/* 8007CA44 000799A4  48 00 00 04 */	b lbl_8007CA48
lbl_8007CA48:
/* 8007CA48 000799A8  48 00 00 04 */	b lbl_8007CA4C
lbl_8007CA4C:
/* 8007CA4C 000799AC  48 00 00 24 */	b lbl_8007CA70
lbl_8007CA50:
/* 8007CA50 000799B0  38 60 00 00 */	li r3, 0
/* 8007CA54 000799B4  81 9B 00 00 */	lwz r12, 0(r27)
/* 8007CA58 000799B8  7D 88 03 A6 */	mtlr r12
/* 8007CA5C 000799BC  4E 80 00 21 */	blrl 
/* 8007CA60 000799C0  7C 60 00 34 */	cntlzw r0, r3
/* 8007CA64 000799C4  83 7B 00 08 */	lwz r27, 8(r27)
/* 8007CA68 000799C8  54 00 D9 7E */	srwi r0, r0, 5
/* 8007CA6C 000799CC  7F 9C 03 78 */	or r28, r28, r0
lbl_8007CA70:
/* 8007CA70 000799D0  28 1B 00 00 */	cmplwi r27, 0
/* 8007CA74 000799D4  40 82 FF DC */	bne lbl_8007CA50
/* 8007CA78 000799D8  48 00 0C 8D */	bl __OSSyncSram
/* 8007CA7C 000799DC  7C 60 00 34 */	cntlzw r0, r3
/* 8007CA80 000799E0  54 00 D9 7E */	srwi r0, r0, 5
/* 8007CA84 000799E4  7F 9C 03 78 */	or r28, r28, r0
/* 8007CA88 000799E8  2C 1C 00 00 */	cmpwi r28, 0
/* 8007CA8C 000799EC  41 82 00 0C */	beq lbl_8007CA98
/* 8007CA90 000799F0  38 00 00 00 */	li r0, 0
/* 8007CA94 000799F4  48 00 00 08 */	b lbl_8007CA9C
lbl_8007CA98:
/* 8007CA98 000799F8  38 00 00 01 */	li r0, 1
lbl_8007CA9C:
/* 8007CA9C 000799FC  2C 00 00 00 */	cmpwi r0, 0
/* 8007CAA0 00079A00  41 82 FF 9C */	beq lbl_8007CA3C
/* 8007CAA4 00079A04  2C 1A 00 01 */	cmpwi r26, 1
/* 8007CAA8 00079A08  40 82 00 38 */	bne lbl_8007CAE0
/* 8007CAAC 00079A0C  2C 1E 00 00 */	cmpwi r30, 0
/* 8007CAB0 00079A10  41 82 00 30 */	beq lbl_8007CAE0
/* 8007CAB4 00079A14  48 00 08 49 */	bl __OSLockSram
/* 8007CAB8 00079A18  88 03 00 13 */	lbz r0, 0x13(r3)
/* 8007CABC 00079A1C  60 00 00 40 */	ori r0, r0, 0x40
/* 8007CAC0 00079A20  98 03 00 13 */	stb r0, 0x13(r3)
/* 8007CAC4 00079A24  38 60 00 01 */	li r3, 1
/* 8007CAC8 00079A28  48 00 0B F5 */	bl __OSUnlockSram
/* 8007CACC 00079A2C  48 00 00 04 */	b lbl_8007CAD0
lbl_8007CAD0:
/* 8007CAD0 00079A30  48 00 00 04 */	b lbl_8007CAD4
lbl_8007CAD4:
/* 8007CAD4 00079A34  48 00 0C 31 */	bl __OSSyncSram
/* 8007CAD8 00079A38  2C 03 00 00 */	cmpwi r3, 0
/* 8007CADC 00079A3C  41 82 FF F8 */	beq lbl_8007CAD4
lbl_8007CAE0:
/* 8007CAE0 00079A40  4B FF E1 45 */	bl OSDisableInterrupts
/* 8007CAE4 00079A44  83 8D 8D A8 */	lwz r28, ResetFunctionQueue-_SDA_BASE_(r13)
/* 8007CAE8 00079A48  3B 60 00 00 */	li r27, 0
/* 8007CAEC 00079A4C  48 00 00 04 */	b lbl_8007CAF0
lbl_8007CAF0:
/* 8007CAF0 00079A50  48 00 00 04 */	b lbl_8007CAF4
lbl_8007CAF4:
/* 8007CAF4 00079A54  48 00 00 24 */	b lbl_8007CB18
lbl_8007CAF8:
/* 8007CAF8 00079A58  38 60 00 01 */	li r3, 1
/* 8007CAFC 00079A5C  81 9C 00 00 */	lwz r12, 0(r28)
/* 8007CB00 00079A60  7D 88 03 A6 */	mtlr r12
/* 8007CB04 00079A64  4E 80 00 21 */	blrl 
/* 8007CB08 00079A68  7C 60 00 34 */	cntlzw r0, r3
/* 8007CB0C 00079A6C  83 9C 00 08 */	lwz r28, 8(r28)
/* 8007CB10 00079A70  54 00 D9 7E */	srwi r0, r0, 5
/* 8007CB14 00079A74  7F 7B 03 78 */	or r27, r27, r0
lbl_8007CB18:
/* 8007CB18 00079A78  28 1C 00 00 */	cmplwi r28, 0
/* 8007CB1C 00079A7C  40 82 FF DC */	bne lbl_8007CAF8
/* 8007CB20 00079A80  48 00 0B E5 */	bl __OSSyncSram
/* 8007CB24 00079A84  4B FF D1 E5 */	bl LCDisable
/* 8007CB28 00079A88  2C 1A 00 01 */	cmpwi r26, 1
/* 8007CB2C 00079A8C  40 82 00 28 */	bne lbl_8007CB54
/* 8007CB30 00079A90  4B FF E0 F5 */	bl OSDisableInterrupts
/* 8007CB34 00079A94  3C 60 CC 00 */	lis r3, 0xCC002000@ha
/* 8007CB38 00079A98  38 63 20 00 */	addi r3, r3, 0xCC002000@l
/* 8007CB3C 00079A9C  38 00 00 00 */	li r0, 0
/* 8007CB40 00079AA0  B0 03 00 02 */	sth r0, 2(r3)
/* 8007CB44 00079AA4  4B FF D1 A1 */	bl ICFlashInvalidate
/* 8007CB48 00079AA8  57 A3 18 38 */	slwi r3, r29, 3
/* 8007CB4C 00079AAC  4B FF FD F9 */	bl Reset
/* 8007CB50 00079AB0  48 00 00 60 */	b lbl_8007CBB0
lbl_8007CB54:
/* 8007CB54 00079AB4  2C 1A 00 00 */	cmpwi r26, 0
/* 8007CB58 00079AB8  40 82 00 58 */	bne lbl_8007CBB0
/* 8007CB5C 00079ABC  3C 60 80 00 */	lis r3, 0x800000DC@ha
/* 8007CB60 00079AC0  80 63 00 DC */	lwz r3, 0x800000DC@l(r3)
/* 8007CB64 00079AC4  48 00 00 04 */	b lbl_8007CB68
lbl_8007CB68:
/* 8007CB68 00079AC8  48 00 00 04 */	b lbl_8007CB6C
lbl_8007CB6C:
/* 8007CB6C 00079ACC  48 00 00 2C */	b lbl_8007CB98
lbl_8007CB70:
/* 8007CB70 00079AD0  A0 03 02 C8 */	lhz r0, 0x2c8(r3)
/* 8007CB74 00079AD4  83 63 02 FC */	lwz r27, 0x2fc(r3)
/* 8007CB78 00079AD8  2C 00 00 04 */	cmpwi r0, 4
/* 8007CB7C 00079ADC  41 82 00 14 */	beq lbl_8007CB90
/* 8007CB80 00079AE0  40 80 00 14 */	bge lbl_8007CB94
/* 8007CB84 00079AE4  2C 00 00 01 */	cmpwi r0, 1
/* 8007CB88 00079AE8  41 82 00 08 */	beq lbl_8007CB90
/* 8007CB8C 00079AEC  48 00 00 08 */	b lbl_8007CB94
lbl_8007CB90:
/* 8007CB90 00079AF0  48 00 19 31 */	bl OSCancelThread
lbl_8007CB94:
/* 8007CB94 00079AF4  7F 63 DB 78 */	mr r3, r27
lbl_8007CB98:
/* 8007CB98 00079AF8  28 03 00 00 */	cmplwi r3, 0
/* 8007CB9C 00079AFC  40 82 FF D4 */	bne lbl_8007CB70
/* 8007CBA0 00079B00  48 00 11 BD */	bl OSEnableScheduler
/* 8007CBA4 00079B04  7F A3 EB 78 */	mr r3, r29
/* 8007CBA8 00079B08  7F C4 F3 78 */	mr r4, r30
/* 8007CBAC 00079B0C  4B FF FB 41 */	bl __OSReboot
lbl_8007CBB0:
/* 8007CBB0 00079B10  3C 60 80 00 */	lis r3, 0x800000DC@ha
/* 8007CBB4 00079B14  80 63 00 DC */	lwz r3, 0x800000DC@l(r3)
/* 8007CBB8 00079B18  48 00 00 04 */	b lbl_8007CBBC
lbl_8007CBBC:
/* 8007CBBC 00079B1C  48 00 00 04 */	b lbl_8007CBC0
lbl_8007CBC0:
/* 8007CBC0 00079B20  48 00 00 2C */	b lbl_8007CBEC
lbl_8007CBC4:
/* 8007CBC4 00079B24  A0 03 02 C8 */	lhz r0, 0x2c8(r3)
/* 8007CBC8 00079B28  83 63 02 FC */	lwz r27, 0x2fc(r3)
/* 8007CBCC 00079B2C  2C 00 00 04 */	cmpwi r0, 4
/* 8007CBD0 00079B30  41 82 00 14 */	beq lbl_8007CBE4
/* 8007CBD4 00079B34  40 80 00 14 */	bge lbl_8007CBE8
/* 8007CBD8 00079B38  2C 00 00 01 */	cmpwi r0, 1
/* 8007CBDC 00079B3C  41 82 00 08 */	beq lbl_8007CBE4
/* 8007CBE0 00079B40  48 00 00 08 */	b lbl_8007CBE8
lbl_8007CBE4:
/* 8007CBE4 00079B44  48 00 18 DD */	bl OSCancelThread
lbl_8007CBE8:
/* 8007CBE8 00079B48  7F 63 DB 78 */	mr r3, r27
lbl_8007CBEC:
/* 8007CBEC 00079B4C  28 03 00 00 */	cmplwi r3, 0
/* 8007CBF0 00079B50  40 82 FF D4 */	bne lbl_8007CBC4
/* 8007CBF4 00079B54  3F A0 80 00 */	lis r29, 0x80000040@ha
/* 8007CBF8 00079B58  38 7D 00 40 */	addi r3, r29, 0x80000040@l
/* 8007CBFC 00079B5C  38 80 00 00 */	li r4, 0
/* 8007CC00 00079B60  38 A0 00 8C */	li r5, 0x8c
/* 8007CC04 00079B64  4B F8 67 A5 */	bl memset
/* 8007CC08 00079B68  38 7D 00 D4 */	addi r3, r29, 0xd4
/* 8007CC0C 00079B6C  38 80 00 00 */	li r4, 0
/* 8007CC10 00079B70  38 A0 00 14 */	li r5, 0x14
/* 8007CC14 00079B74  4B F8 67 95 */	bl memset
/* 8007CC18 00079B78  38 7D 00 F4 */	addi r3, r29, 0xf4
/* 8007CC1C 00079B7C  38 80 00 00 */	li r4, 0
/* 8007CC20 00079B80  38 A0 00 04 */	li r5, 4
/* 8007CC24 00079B84  4B F8 67 85 */	bl memset
/* 8007CC28 00079B88  38 7D 30 00 */	addi r3, r29, 0x3000
/* 8007CC2C 00079B8C  38 80 00 00 */	li r4, 0
/* 8007CC30 00079B90  38 A0 00 C0 */	li r5, 0xc0
/* 8007CC34 00079B94  4B F8 67 75 */	bl memset
/* 8007CC38 00079B98  38 7D 30 C8 */	addi r3, r29, 0x30c8
/* 8007CC3C 00079B9C  38 80 00 00 */	li r4, 0
/* 8007CC40 00079BA0  38 A0 00 0C */	li r5, 0xc
/* 8007CC44 00079BA4  4B F8 67 65 */	bl memset
/* 8007CC48 00079BA8  38 7D 30 E2 */	addi r3, r29, 0x30e2
/* 8007CC4C 00079BAC  38 80 00 00 */	li r4, 0
/* 8007CC50 00079BB0  38 A0 00 01 */	li r5, 1
/* 8007CC54 00079BB4  4B F8 67 55 */	bl memset
/* 8007CC58 00079BB8  7F E3 FB 78 */	mr r3, r31
/* 8007CC5C 00079BBC  48 00 EC 51 */	bl __PADDisableRecalibration
/* 8007CC60 00079BC0  BB 41 00 28 */	lmw r26, 0x28(r1)
/* 8007CC64 00079BC4  80 01 00 44 */	lwz r0, 0x44(r1)
/* 8007CC68 00079BC8  38 21 00 40 */	addi r1, r1, 0x40
/* 8007CC6C 00079BCC  7C 08 03 A6 */	mtlr r0
/* 8007CC70 00079BD0  4E 80 00 20 */	blr 

.global OSGetResetCode
OSGetResetCode:
/* 8007CC74 00079BD4  3C 60 80 00 */	lis r3, 0x800030E2@ha
/* 8007CC78 00079BD8  88 03 30 E2 */	lbz r0, 0x800030E2@l(r3)
/* 8007CC7C 00079BDC  28 00 00 00 */	cmplwi r0, 0
/* 8007CC80 00079BE0  41 82 00 0C */	beq lbl_8007CC8C
/* 8007CC84 00079BE4  3C 60 80 00 */	lis r3, 0x8000
/* 8007CC88 00079BE8  48 00 00 18 */	b lbl_8007CCA0
lbl_8007CC8C:
/* 8007CC8C 00079BEC  3C 60 CC 00 */	lis r3, 0xCC003000@ha
/* 8007CC90 00079BF0  38 63 30 00 */	addi r3, r3, 0xCC003000@l
/* 8007CC94 00079BF4  80 03 00 24 */	lwz r0, 0x24(r3)
/* 8007CC98 00079BF8  54 00 00 38 */	rlwinm r0, r0, 0, 0, 0x1c
/* 8007CC9C 00079BFC  54 03 E8 FE */	srwi r3, r0, 3
lbl_8007CCA0:
/* 8007CCA0 00079C00  4E 80 00 20 */	blr 
