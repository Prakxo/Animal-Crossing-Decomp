.include "macros.inc"

.section .text

.org 0x8007C6A0

.global Run
Run:
/* 8007C6A0 00079600  7C 08 02 A6 */	mflr r0
/* 8007C6A4 00079604  90 01 00 04 */	stw r0, 4(r1)
/* 8007C6A8 00079608  94 21 FF E8 */	stwu r1, -0x18(r1)
/* 8007C6AC 0007960C  93 E1 00 14 */	stw r31, 0x14(r1)
/* 8007C6B0 00079610  7C 7F 1B 78 */	mr r31, r3
/* 8007C6B4 00079614  4B FF E5 71 */	bl OSDisableInterrupts
/* 8007C6B8 00079618  4B FF D6 2D */	bl ICFlashInvalidate
/* 8007C6BC 0007961C  7C 00 04 AC */	sync 0
/* 8007C6C0 00079620  4C 00 01 2C */	isync 
/* 8007C6C4 00079624  7F E8 03 A6 */	mtlr r31
/* 8007C6C8 00079628  4E 80 00 20 */	blr 
/* 8007C6CC 0007962C  80 01 00 1C */	lwz r0, 0x1c(r1)
/* 8007C6D0 00079630  83 E1 00 14 */	lwz r31, 0x14(r1)
/* 8007C6D4 00079634  38 21 00 18 */	addi r1, r1, 0x18
/* 8007C6D8 00079638  7C 08 03 A6 */	mtlr r0
/* 8007C6DC 0007963C  4E 80 00 20 */	blr 

.global Callback
Callback:
/* 8007C6E0 00079640  38 00 00 01 */	li r0, 1
/* 8007C6E4 00079644  90 0D 8D A0 */	stw r0, Prepared-_SDA_BASE_(r13)
/* 8007C6E8 00079648  4E 80 00 20 */	blr 

.global __OSReboot
__OSReboot:
/* 8007C6EC 0007964C  7C 08 02 A6 */	mflr r0
/* 8007C6F0 00079650  90 01 00 04 */	stw r0, 4(r1)
/* 8007C6F4 00079654  94 21 FC C0 */	stwu r1, -0x340(r1)
/* 8007C6F8 00079658  93 E1 03 3C */	stw r31, 0x33c(r1)
/* 8007C6FC 0007965C  93 C1 03 38 */	stw r30, 0x338(r1)
/* 8007C700 00079660  3C 60 80 20 */	lis r3, Header@ha
/* 8007C704 00079664  3B C3 73 E0 */	addi r30, r3, Header@l
/* 8007C708 00079668  4B FF E5 1D */	bl OSDisableInterrupts
/* 8007C70C 0007966C  80 AD 8D 98 */	lwz r5, SaveStart-_SDA_BASE_(r13)
/* 8007C710 00079670  3C 80 81 30 */	lis r4, 0x812FDFF0@ha
/* 8007C714 00079674  80 0D 8D 9C */	lwz r0, SaveEnd-_SDA_BASE_(r13)
/* 8007C718 00079678  38 60 00 00 */	li r3, 0
/* 8007C71C 0007967C  3F E0 81 80 */	lis r31, 0x817FFFFC@ha
/* 8007C720 00079680  38 E0 00 01 */	li r7, 1
/* 8007C724 00079684  90 7F FF FC */	stw r3, 0x817FFFFC@l(r31)
/* 8007C728 00079688  3C C0 80 00 */	lis r6, 0x800030E2@ha
/* 8007C72C 0007968C  90 7F FF F8 */	stw r3, -8(r31)
/* 8007C730 00079690  38 61 00 70 */	addi r3, r1, 0x70
/* 8007C734 00079694  98 E6 30 E2 */	stb r7, 0x800030E2@l(r6)
/* 8007C738 00079698  90 A4 DF F0 */	stw r5, 0x812FDFF0@l(r4)
/* 8007C73C 0007969C  90 04 DF EC */	stw r0, -0x2014(r4)
/* 8007C740 000796A0  4B FF DC F1 */	bl OSClearContext
/* 8007C744 000796A4  38 61 00 70 */	addi r3, r1, 0x70
/* 8007C748 000796A8  4B FF DB 21 */	bl OSSetCurrentContext
/* 8007C74C 000796AC  48 00 89 A9 */	bl DVDInit
/* 8007C750 000796B0  38 60 00 01 */	li r3, 1
/* 8007C754 000796B4  48 00 AB 15 */	bl DVDSetAutoInvalidation
/* 8007C758 000796B8  3C 60 80 08 */	lis r3, Callback@ha
/* 8007C75C 000796BC  38 63 C6 E0 */	addi r3, r3, Callback@l
/* 8007C760 000796C0  48 00 AF 45 */	bl __DVDPrepareResetAsync
/* 8007C764 000796C4  48 00 AE 5D */	bl DVDCheckDisk
/* 8007C768 000796C8  2C 03 00 00 */	cmpwi r3, 0
/* 8007C76C 000796CC  40 82 00 0C */	bne lbl_8007C778
/* 8007C770 000796D0  80 7F FF FC */	lwz r3, -4(r31)
/* 8007C774 000796D4  48 00 02 41 */	bl __OSDoHotReset
lbl_8007C778:
/* 8007C778 000796D8  38 60 FF E0 */	li r3, -32
/* 8007C77C 000796DC  4B FF E8 71 */	bl __OSMaskInterrupts
/* 8007C780 000796E0  38 60 04 00 */	li r3, 0x400
/* 8007C784 000796E4  4B FF E8 F1 */	bl __OSUnmaskInterrupts
/* 8007C788 000796E8  4B FF E4 B1 */	bl OSEnableInterrupts
/* 8007C78C 000796EC  48 00 00 04 */	b lbl_8007C790
lbl_8007C790:
/* 8007C790 000796F0  48 00 00 04 */	b lbl_8007C794
lbl_8007C794:
/* 8007C794 000796F4  80 0D 8D A0 */	lwz r0, Prepared-_SDA_BASE_(r13)
/* 8007C798 000796F8  2C 00 00 00 */	cmpwi r0, 0
/* 8007C79C 000796FC  41 82 FF F8 */	beq lbl_8007C794
/* 8007C7A0 00079700  7F C4 F3 78 */	mr r4, r30
/* 8007C7A4 00079704  38 61 00 40 */	addi r3, r1, 0x40
/* 8007C7A8 00079708  38 A0 00 20 */	li r5, 0x20
/* 8007C7AC 0007970C  38 C0 24 40 */	li r6, 0x2440
/* 8007C7B0 00079710  38 E0 00 00 */	li r7, 0
/* 8007C7B4 00079714  48 00 A5 79 */	bl DVDReadAbsAsyncForBS
/* 8007C7B8 00079718  3F E0 81 80 */	lis r31, 0x8180
/* 8007C7BC 0007971C  48 00 00 04 */	b lbl_8007C7C0
lbl_8007C7C0:
/* 8007C7C0 00079720  48 00 00 04 */	b lbl_8007C7C4
lbl_8007C7C4:
/* 8007C7C4 00079724  80 01 00 4C */	lwz r0, 0x4c(r1)
/* 8007C7C8 00079728  2C 00 00 01 */	cmpwi r0, 1
/* 8007C7CC 0007972C  41 82 FF F8 */	beq lbl_8007C7C4
/* 8007C7D0 00079730  40 80 00 14 */	bge lbl_8007C7E4
/* 8007C7D4 00079734  2C 00 FF FF */	cmpwi r0, -1
/* 8007C7D8 00079738  41 82 00 18 */	beq lbl_8007C7F0
/* 8007C7DC 0007973C  40 80 00 20 */	bge lbl_8007C7FC
/* 8007C7E0 00079740  4B FF FF E4 */	b lbl_8007C7C4
lbl_8007C7E4:
/* 8007C7E4 00079744  2C 00 00 0C */	cmpwi r0, 0xc
/* 8007C7E8 00079748  40 80 FF DC */	bge lbl_8007C7C4
/* 8007C7EC 0007974C  48 00 00 04 */	b lbl_8007C7F0
lbl_8007C7F0:
/* 8007C7F0 00079750  80 7F FF FC */	lwz r3, -4(r31)
/* 8007C7F4 00079754  48 00 01 C1 */	bl __OSDoHotReset
/* 8007C7F8 00079758  4B FF FF CC */	b lbl_8007C7C4
lbl_8007C7FC:
/* 8007C7FC 0007975C  80 7E 00 18 */	lwz r3, 0x18(r30)
/* 8007C800 00079760  80 9E 00 14 */	lwz r4, 0x14(r30)
/* 8007C804 00079764  38 03 00 1F */	addi r0, r3, 0x1f
/* 8007C808 00079768  38 84 00 20 */	addi r4, r4, 0x20
/* 8007C80C 0007976C  54 1E 00 34 */	rlwinm r30, r0, 0, 0, 0x1a
/* 8007C810 00079770  48 00 00 04 */	b lbl_8007C814
lbl_8007C814:
/* 8007C814 00079774  48 00 00 04 */	b lbl_8007C818
lbl_8007C818:
/* 8007C818 00079778  80 0D 8D A0 */	lwz r0, Prepared-_SDA_BASE_(r13)
/* 8007C81C 0007977C  2C 00 00 00 */	cmpwi r0, 0
/* 8007C820 00079780  41 82 FF F8 */	beq lbl_8007C818
/* 8007C824 00079784  7F C5 F3 78 */	mr r5, r30
/* 8007C828 00079788  38 61 00 10 */	addi r3, r1, 0x10
/* 8007C82C 0007978C  38 C4 24 40 */	addi r6, r4, 0x2440
/* 8007C830 00079790  3C 80 81 30 */	lis r4, 0x8130
/* 8007C834 00079794  38 E0 00 00 */	li r7, 0
/* 8007C838 00079798  48 00 A4 F5 */	bl DVDReadAbsAsyncForBS
/* 8007C83C 0007979C  3F E0 81 80 */	lis r31, 0x8180
/* 8007C840 000797A0  48 00 00 04 */	b lbl_8007C844
lbl_8007C844:
/* 8007C844 000797A4  48 00 00 04 */	b lbl_8007C848
lbl_8007C848:
/* 8007C848 000797A8  80 01 00 1C */	lwz r0, 0x1c(r1)
/* 8007C84C 000797AC  2C 00 00 01 */	cmpwi r0, 1
/* 8007C850 000797B0  41 82 FF F8 */	beq lbl_8007C848
/* 8007C854 000797B4  40 80 00 14 */	bge lbl_8007C868
/* 8007C858 000797B8  2C 00 FF FF */	cmpwi r0, -1
/* 8007C85C 000797BC  41 82 00 18 */	beq lbl_8007C874
/* 8007C860 000797C0  40 80 00 20 */	bge lbl_8007C880
/* 8007C864 000797C4  4B FF FF E4 */	b lbl_8007C848
lbl_8007C868:
/* 8007C868 000797C8  2C 00 00 0C */	cmpwi r0, 0xc
/* 8007C86C 000797CC  40 80 FF DC */	bge lbl_8007C848
/* 8007C870 000797D0  48 00 00 04 */	b lbl_8007C874
lbl_8007C874:
/* 8007C874 000797D4  80 7F FF FC */	lwz r3, -4(r31)
/* 8007C878 000797D8  48 00 01 3D */	bl __OSDoHotReset
/* 8007C87C 000797DC  4B FF FF CC */	b lbl_8007C848
lbl_8007C880:
/* 8007C880 000797E0  3C 60 81 30 */	lis r3, 0x8130
/* 8007C884 000797E4  7F C4 F3 78 */	mr r4, r30
/* 8007C888 000797E8  4B FF D4 25 */	bl ICInvalidateRange
/* 8007C88C 000797EC  3C 60 81 30 */	lis r3, 0x8130
/* 8007C890 000797F0  4B FF FE 11 */	bl Run
/* 8007C894 000797F4  80 01 03 44 */	lwz r0, 0x344(r1)
/* 8007C898 000797F8  83 E1 03 3C */	lwz r31, 0x33c(r1)
/* 8007C89C 000797FC  83 C1 03 38 */	lwz r30, 0x338(r1)
/* 8007C8A0 00079800  38 21 03 40 */	addi r1, r1, 0x340
/* 8007C8A4 00079804  7C 08 03 A6 */	mtlr r0
/* 8007C8A8 00079808  4E 80 00 20 */	blr 

.global OSGetSaveRegion
OSGetSaveRegion:
/* 8007C8AC 0007980C  80 0D 8D 98 */	lwz r0, SaveStart-_SDA_BASE_(r13)
/* 8007C8B0 00079810  90 03 00 00 */	stw r0, 0(r3)
/* 8007C8B4 00079814  80 0D 8D 9C */	lwz r0, SaveEnd-_SDA_BASE_(r13)
/* 8007C8B8 00079818  90 04 00 00 */	stw r0, 0(r4)
/* 8007C8BC 0007981C  4E 80 00 20 */	blr 
