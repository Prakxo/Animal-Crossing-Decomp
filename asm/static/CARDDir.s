.include "macros.inc"

.section .text

.org 0x8008EBD8

.global __CARDGetDirBlock
__CARDGetDirBlock:
/* 8008EBD8 0008BB38  80 63 00 84 */	lwz r3, 0x84(r3)
/* 8008EBDC 0008BB3C  4E 80 00 20 */	blr 

.global WriteCallback
WriteCallback:
/* 8008EBE0 0008BB40  7C 08 02 A6 */	mflr r0
/* 8008EBE4 0008BB44  90 01 00 04 */	stw r0, 4(r1)
/* 8008EBE8 0008BB48  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 8008EBEC 0008BB4C  93 E1 00 1C */	stw r31, 0x1c(r1)
/* 8008EBF0 0008BB50  93 C1 00 18 */	stw r30, 0x18(r1)
/* 8008EBF4 0008BB54  7C 9E 23 79 */	or. r30, r4, r4
/* 8008EBF8 0008BB58  93 A1 00 14 */	stw r29, 0x14(r1)
/* 8008EBFC 0008BB5C  3B A3 00 00 */	addi r29, r3, 0
/* 8008EC00 0008BB60  1C BD 01 10 */	mulli r5, r29, 0x110
/* 8008EC04 0008BB64  3C 60 80 21 */	lis r3, __CARDBlock@ha
/* 8008EC08 0008BB68  38 03 84 E0 */	addi r0, r3, __CARDBlock@l
/* 8008EC0C 0008BB6C  7F E0 2A 14 */	add r31, r0, r5
/* 8008EC10 0008BB70  41 80 00 44 */	blt lbl_8008EC54
/* 8008EC14 0008BB74  80 7F 00 80 */	lwz r3, 0x80(r31)
/* 8008EC18 0008BB78  80 1F 00 84 */	lwz r0, 0x84(r31)
/* 8008EC1C 0008BB7C  38 83 20 00 */	addi r4, r3, 0x2000
/* 8008EC20 0008BB80  7C 00 20 40 */	cmplw r0, r4
/* 8008EC24 0008BB84  38 03 40 00 */	addi r0, r3, 0x4000
/* 8008EC28 0008BB88  40 82 00 18 */	bne lbl_8008EC40
/* 8008EC2C 0008BB8C  90 1F 00 84 */	stw r0, 0x84(r31)
/* 8008EC30 0008BB90  7C 03 03 78 */	mr r3, r0
/* 8008EC34 0008BB94  38 A0 20 00 */	li r5, 0x2000
/* 8008EC38 0008BB98  4B F7 48 59 */	bl memcpy
/* 8008EC3C 0008BB9C  48 00 00 18 */	b lbl_8008EC54
lbl_8008EC40:
/* 8008EC40 0008BBA0  90 9F 00 84 */	stw r4, 0x84(r31)
/* 8008EC44 0008BBA4  38 64 00 00 */	addi r3, r4, 0
/* 8008EC48 0008BBA8  7C 04 03 78 */	mr r4, r0
/* 8008EC4C 0008BBAC  38 A0 20 00 */	li r5, 0x2000
/* 8008EC50 0008BBB0  4B F7 48 41 */	bl memcpy
lbl_8008EC54:
/* 8008EC54 0008BBB4  80 1F 00 D0 */	lwz r0, 0xd0(r31)
/* 8008EC58 0008BBB8  28 00 00 00 */	cmplwi r0, 0
/* 8008EC5C 0008BBBC  40 82 00 10 */	bne lbl_8008EC6C
/* 8008EC60 0008BBC0  38 7F 00 00 */	addi r3, r31, 0
/* 8008EC64 0008BBC4  38 9E 00 00 */	addi r4, r30, 0
/* 8008EC68 0008BBC8  4B FF F5 9D */	bl __CARDPutControlBlock
lbl_8008EC6C:
/* 8008EC6C 0008BBCC  80 1F 00 D8 */	lwz r0, 0xd8(r31)
/* 8008EC70 0008BBD0  28 00 00 00 */	cmplwi r0, 0
/* 8008EC74 0008BBD4  7C 0C 03 78 */	mr r12, r0
/* 8008EC78 0008BBD8  41 82 00 1C */	beq lbl_8008EC94
/* 8008EC7C 0008BBDC  38 00 00 00 */	li r0, 0
/* 8008EC80 0008BBE0  7D 88 03 A6 */	mtlr r12
/* 8008EC84 0008BBE4  90 1F 00 D8 */	stw r0, 0xd8(r31)
/* 8008EC88 0008BBE8  38 7D 00 00 */	addi r3, r29, 0
/* 8008EC8C 0008BBEC  38 9E 00 00 */	addi r4, r30, 0
/* 8008EC90 0008BBF0  4E 80 00 21 */	blrl 
lbl_8008EC94:
/* 8008EC94 0008BBF4  80 01 00 24 */	lwz r0, 0x24(r1)
/* 8008EC98 0008BBF8  83 E1 00 1C */	lwz r31, 0x1c(r1)
/* 8008EC9C 0008BBFC  83 C1 00 18 */	lwz r30, 0x18(r1)
/* 8008ECA0 0008BC00  83 A1 00 14 */	lwz r29, 0x14(r1)
/* 8008ECA4 0008BC04  38 21 00 20 */	addi r1, r1, 0x20
/* 8008ECA8 0008BC08  7C 08 03 A6 */	mtlr r0
/* 8008ECAC 0008BC0C  4E 80 00 20 */	blr 

.global EraseCallback
EraseCallback:
/* 8008ECB0 0008BC10  7C 08 02 A6 */	mflr r0
/* 8008ECB4 0008BC14  90 01 00 04 */	stw r0, 4(r1)
/* 8008ECB8 0008BC18  94 21 FF D8 */	stwu r1, -0x28(r1)
/* 8008ECBC 0008BC1C  93 E1 00 24 */	stw r31, 0x24(r1)
/* 8008ECC0 0008BC20  3B E3 00 00 */	addi r31, r3, 0
/* 8008ECC4 0008BC24  3C 60 80 21 */	lis r3, __CARDBlock@ha
/* 8008ECC8 0008BC28  93 C1 00 20 */	stw r30, 0x20(r1)
/* 8008ECCC 0008BC2C  1C BF 01 10 */	mulli r5, r31, 0x110
/* 8008ECD0 0008BC30  93 A1 00 1C */	stw r29, 0x1c(r1)
/* 8008ECD4 0008BC34  38 03 84 E0 */	addi r0, r3, __CARDBlock@l
/* 8008ECD8 0008BC38  7C 9D 23 79 */	or. r29, r4, r4
/* 8008ECDC 0008BC3C  7F C0 2A 14 */	add r30, r0, r5
/* 8008ECE0 0008BC40  41 80 00 3C */	blt lbl_8008ED1C
/* 8008ECE4 0008BC44  80 BE 00 84 */	lwz r5, 0x84(r30)
/* 8008ECE8 0008BC48  3C 60 80 09 */	lis r3, WriteCallback@ha
/* 8008ECEC 0008BC4C  80 1E 00 80 */	lwz r0, 0x80(r30)
/* 8008ECF0 0008BC50  38 E3 EB E0 */	addi r7, r3, WriteCallback@l
/* 8008ECF4 0008BC54  80 7E 00 0C */	lwz r3, 0xc(r30)
/* 8008ECF8 0008BC58  7C 00 28 50 */	subf r0, r0, r5
/* 8008ECFC 0008BC5C  54 00 9B 7E */	srwi r0, r0, 0xd
/* 8008ED00 0008BC60  7C 83 01 D6 */	mullw r4, r3, r0
/* 8008ED04 0008BC64  38 C5 00 00 */	addi r6, r5, 0
/* 8008ED08 0008BC68  38 7F 00 00 */	addi r3, r31, 0
/* 8008ED0C 0008BC6C  38 A0 20 00 */	li r5, 0x2000
/* 8008ED10 0008BC70  4B FF FA 61 */	bl __CARDWrite
/* 8008ED14 0008BC74  7C 7D 1B 79 */	or. r29, r3, r3
/* 8008ED18 0008BC78  40 80 00 44 */	bge lbl_8008ED5C
lbl_8008ED1C:
/* 8008ED1C 0008BC7C  80 1E 00 D0 */	lwz r0, 0xd0(r30)
/* 8008ED20 0008BC80  28 00 00 00 */	cmplwi r0, 0
/* 8008ED24 0008BC84  40 82 00 10 */	bne lbl_8008ED34
/* 8008ED28 0008BC88  38 7E 00 00 */	addi r3, r30, 0
/* 8008ED2C 0008BC8C  38 9D 00 00 */	addi r4, r29, 0
/* 8008ED30 0008BC90  4B FF F4 D5 */	bl __CARDPutControlBlock
lbl_8008ED34:
/* 8008ED34 0008BC94  80 1E 00 D8 */	lwz r0, 0xd8(r30)
/* 8008ED38 0008BC98  28 00 00 00 */	cmplwi r0, 0
/* 8008ED3C 0008BC9C  7C 0C 03 78 */	mr r12, r0
/* 8008ED40 0008BCA0  41 82 00 1C */	beq lbl_8008ED5C
/* 8008ED44 0008BCA4  38 00 00 00 */	li r0, 0
/* 8008ED48 0008BCA8  7D 88 03 A6 */	mtlr r12
/* 8008ED4C 0008BCAC  90 1E 00 D8 */	stw r0, 0xd8(r30)
/* 8008ED50 0008BCB0  38 7F 00 00 */	addi r3, r31, 0
/* 8008ED54 0008BCB4  38 9D 00 00 */	addi r4, r29, 0
/* 8008ED58 0008BCB8  4E 80 00 21 */	blrl 
lbl_8008ED5C:
/* 8008ED5C 0008BCBC  80 01 00 2C */	lwz r0, 0x2c(r1)
/* 8008ED60 0008BCC0  83 E1 00 24 */	lwz r31, 0x24(r1)
/* 8008ED64 0008BCC4  83 C1 00 20 */	lwz r30, 0x20(r1)
/* 8008ED68 0008BCC8  83 A1 00 1C */	lwz r29, 0x1c(r1)
/* 8008ED6C 0008BCCC  38 21 00 28 */	addi r1, r1, 0x28
/* 8008ED70 0008BCD0  7C 08 03 A6 */	mtlr r0
/* 8008ED74 0008BCD4  4E 80 00 20 */	blr 

.global __CARDUpdateDir
__CARDUpdateDir:
/* 8008ED78 0008BCD8  7C 08 02 A6 */	mflr r0
/* 8008ED7C 0008BCDC  90 01 00 04 */	stw r0, 4(r1)
/* 8008ED80 0008BCE0  94 21 FF D8 */	stwu r1, -0x28(r1)
/* 8008ED84 0008BCE4  93 E1 00 24 */	stw r31, 0x24(r1)
/* 8008ED88 0008BCE8  93 C1 00 20 */	stw r30, 0x20(r1)
/* 8008ED8C 0008BCEC  93 A1 00 1C */	stw r29, 0x1c(r1)
/* 8008ED90 0008BCF0  3B A4 00 00 */	addi r29, r4, 0
/* 8008ED94 0008BCF4  93 81 00 18 */	stw r28, 0x18(r1)
/* 8008ED98 0008BCF8  3B 83 00 00 */	addi r28, r3, 0
/* 8008ED9C 0008BCFC  1C BC 01 10 */	mulli r5, r28, 0x110
/* 8008EDA0 0008BD00  3C 60 80 21 */	lis r3, __CARDBlock@ha
/* 8008EDA4 0008BD04  38 03 84 E0 */	addi r0, r3, __CARDBlock@l
/* 8008EDA8 0008BD08  7F C0 2A 14 */	add r30, r0, r5
/* 8008EDAC 0008BD0C  80 1E 00 00 */	lwz r0, 0(r30)
/* 8008EDB0 0008BD10  2C 00 00 00 */	cmpwi r0, 0
/* 8008EDB4 0008BD14  40 82 00 0C */	bne lbl_8008EDC0
/* 8008EDB8 0008BD18  38 60 FF FD */	li r3, -3
/* 8008EDBC 0008BD1C  48 00 00 60 */	b lbl_8008EE1C
lbl_8008EDC0:
/* 8008EDC0 0008BD20  83 FE 00 84 */	lwz r31, 0x84(r30)
/* 8008EDC4 0008BD24  38 80 1F FC */	li r4, 0x1ffc
/* 8008EDC8 0008BD28  A8 BF 1F FA */	lha r5, 0x1ffa(r31)
/* 8008EDCC 0008BD2C  38 DF 1F C0 */	addi r6, r31, 0x1fc0
/* 8008EDD0 0008BD30  38 7F 00 00 */	addi r3, r31, 0
/* 8008EDD4 0008BD34  38 05 00 01 */	addi r0, r5, 1
/* 8008EDD8 0008BD38  B0 1F 1F FA */	sth r0, 0x1ffa(r31)
/* 8008EDDC 0008BD3C  38 A6 00 3C */	addi r5, r6, 0x3c
/* 8008EDE0 0008BD40  38 C6 00 3E */	addi r6, r6, 0x3e
/* 8008EDE4 0008BD44  48 00 00 59 */	bl __CARDCheckSum
/* 8008EDE8 0008BD48  38 7F 00 00 */	addi r3, r31, 0
/* 8008EDEC 0008BD4C  38 80 20 00 */	li r4, 0x2000
/* 8008EDF0 0008BD50  4B FE AD C9 */	bl DCStoreRange
/* 8008EDF4 0008BD54  93 BE 00 D8 */	stw r29, 0xd8(r30)
/* 8008EDF8 0008BD58  3C 60 80 09 */	lis r3, EraseCallback@ha
/* 8008EDFC 0008BD5C  38 A3 EC B0 */	addi r5, r3, EraseCallback@l
/* 8008EE00 0008BD60  80 1E 00 80 */	lwz r0, 0x80(r30)
/* 8008EE04 0008BD64  7F 83 E3 78 */	mr r3, r28
/* 8008EE08 0008BD68  80 9E 00 0C */	lwz r4, 0xc(r30)
/* 8008EE0C 0008BD6C  7C 00 F8 50 */	subf r0, r0, r31
/* 8008EE10 0008BD70  54 00 9B 7E */	srwi r0, r0, 0xd
/* 8008EE14 0008BD74  7C 84 01 D6 */	mullw r4, r4, r0
/* 8008EE18 0008BD78  4B FF F1 81 */	bl __CARDEraseSector
lbl_8008EE1C:
/* 8008EE1C 0008BD7C  80 01 00 2C */	lwz r0, 0x2c(r1)
/* 8008EE20 0008BD80  83 E1 00 24 */	lwz r31, 0x24(r1)
/* 8008EE24 0008BD84  83 C1 00 20 */	lwz r30, 0x20(r1)
/* 8008EE28 0008BD88  83 A1 00 1C */	lwz r29, 0x1c(r1)
/* 8008EE2C 0008BD8C  83 81 00 18 */	lwz r28, 0x18(r1)
/* 8008EE30 0008BD90  38 21 00 28 */	addi r1, r1, 0x28
/* 8008EE34 0008BD94  7C 08 03 A6 */	mtlr r0
/* 8008EE38 0008BD98  4E 80 00 20 */	blr 
